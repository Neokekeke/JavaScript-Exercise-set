<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>图片压缩上传</title>
</head>
<body>

<input id="file" type="file">
<img id="img">

<script>
    //DOM对象
    var eleFile = document.getElementById("file");
    var image = document.getElementById("img");

    //压缩图片需要的元素和对象
    var reader = new FileReader();
    var img = new Image();

    //选择的文件对象
    var file = null;

    //缩放图片需要的canvas
    var canvas = document.createElement('canvas');
    var context = canvas.getContext('2d');

    //base64地址，图片加载完成后
    img.onload = function(){

        //图片原始尺寸
        var originWidth = this.width;
        var originHeight = this.height;

        //上传尺寸最大限制
        var maxWidth = 500;
        var maxHeight = 500;

        //目标的尺寸
        var targetWidth = originWidth;
        var targetHeight = originHeight;

        //图片尺寸超出500*500的限制
        if(originWidth > maxWidth || originHeight > maxHeight) {
            if (originWidth / originHeight > maxWidth / maxHeight) {
                //更改图片宽度，按照宽度限定尺寸
                targetWidth = maxWidth;
                targetHeight = Math.round(maxWidth * (originHeight / originWidth));
            } else {
                targetHeight = maxHeight;
                targetWidth = Math.round(maxHeight * (originWidth / originHeight));
            }

            //canvas对图片进行缩放
            canvas.width = targetWidth;
            canvas.height = targetHeight;

            //清除完画布
            context.clearRect(0, 0, targetWidth , targetHeight);

            //图片开始压缩
            context.drawImage(img , 0 , 0 , targetWidth , targetHeight);

            canvas.toDataURL();
        }
    };

    reader.onload = function(e){
        img.src = e.target.result;
        image.src = img.src;
        console.log(e);
        console.log(img.src);
    };

    eleFile.addEventListener('change' , function(e){
        console.log(e);
        file = event.target.files[0];
        //如果选择的是图片
        if(file.type.indexOf("image") == 0){
            //转化成base64
            reader.readAsDataURL(file);
        }
    });

    console.log(img);





















</script>

</body>
</html>